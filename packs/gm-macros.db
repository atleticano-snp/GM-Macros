{"name":"Cub_Condition","type":"script","author":"05k4ub2VgC3VLxAg","img":"icons/svg/dice-target.svg","scope":"global","command":"// Add this Callback macro to your GM's hotbar and use Furnace mod to check \"Execute as GM\".\n// You should only pass the target id to this macro\n(async ()=>{\nlet target = canvas.tokens.get(args[0]);\nlet condition = args[1];\nlet state = args[2];\nif (state === \"remove\"){\n    await game.cub.removeCondition(condition, target, {warn: false});\n}\nif (state === \"add\"){\n    await game.cub.addCondition(condition, target, {warn: false});\n}\n})();","folder":null,"sort":0,"permission":{"default":0,"05k4ub2VgC3VLxAg":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"core":{"sourceId":"Macro.wbsKf4dUUzI1wulP"}},"_id":"0yoFSWpbTtpFaBLW"}
{"name":"Change Token Vision","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Change Token Vision ","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.yLoutC95PjwpImHm"}},"scope":"global","command":"// Open a dialog for quickly changing token vision parameters of the controlled tokens.\n// This macro was written by @Sky#9453\n// https://github.com/Sky-Captain-13/foundry\n\nif (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Please select a token first\");\n\nlet applyChanges = false;\nnew Dialog({\n  title: `Token Vision Configuration`,\n  content: `\n    <form>\n      <div class=\"form-group\">\n        <label>Vision Type:</label>\n        <select id=\"vision-type\" name=\"vision-type\">\n          <option value=\"nochange\">No Change</option>\n          <option value=\"dim0\">Self</option>\n          <option value=\"dim30\">Darkvision (30 ft)</option>\n          <option value=\"dim60\">Darkvision (60 ft)</option>\n          <option value=\"dim90\">Darkvision (90 ft)</option>\n          <option value=\"dim120\">Darkvision (120 ft)</option>\n          <option value=\"dim150\">Darkvision (150 ft)</option>\n          <option value=\"dim180\">Darkvision (180 ft)</option>\n          <option value=\"bright120\">Devil's Sight (Warlock)</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label>Light Source:</label>\n        <select id=\"light-source\" name=\"light-source\">\n          <option value=\"nochange\">No Change</option>\n          <option value=\"none\">None</option>\n          <option value=\"candle\">Candle</option>\n          <option value=\"lamp\">Lamp</option>\n          <option value=\"bullseye\">Lantern (Bullseye)</option>\n          <option value=\"hooded-dim\">Lantern (Hooded - Dim)</option>\n          <option value=\"hooded-bright\">Lantern (Hooded - Bright)</option>\n          <option value=\"light\">Light (Cantrip)</option>\n          <option value=\"torch\">Torch</option>\n        </select>\n      </div>\n    </form>\n    `,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Apply Changes`,\n      callback: () => applyChanges = true\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: `Cancel Changes`\n    },\n  },\n  default: \"yes\",\n  close: html => {\n    if (applyChanges) {\n      for ( let token of canvas.tokens.controlled ) {\n        let visionType = html.find('[name=\"vision-type\"]')[0].value || \"none\";\n        let lightSource = html.find('[name=\"light-source\"]')[0].value || \"none\";\n        let dimSight = 0;\n        let brightSight = 0;\n        let dimLight = 0;\n        let brightLight = 0;\n        let lightAngle = 360;\n        let lockRotation = token.data.lockRotation;\n        // Get Vision Type Values\n        switch (visionType) {\n          case \"dim0\":\n            dimSight = 0;\n            brightSight = 0;\n            break;\n          case \"dim30\":\n            dimSight = 30;\n            brightSight = 0;\n            break;\n          case \"dim60\":\n            dimSight = 60;\n            brightSight = 0;\n            break;\n          case \"dim90\":\n            dimSight = 90;\n            brightSight = 0;\n            break;\n          case \"dim120\":\n            dimSight = 120;\n            brightSight = 0;\n            break;\n          case \"dim150\":\n            dimSight = 150;\n            brightSight = 0;\n            break;\n          case \"dim180\":\n            dimSight = 180;\n            brightSight = 0;\n            break;\n          case \"bright120\":\n            dimSight = 0;\n            brightSight= 120;\n            break;\n          case \"nochange\":\n          default:\n            dimSight = token.data.dimSight;\n            brightSight = token.data.brightSight;\n        }\n        // Get Light Source Values\n        switch (lightSource) {\n          case \"none\":\n            dimLight = 0;\n            brightLight = 0;\n            break;\n          case \"candle\":\n            dimLight = 10;\n            brightLight = 5;\n            break;\n          case \"lamp\":\n            dimLight = 45;\n            brightLight = 15;\n            break;\n          case \"bullseye\":\n            dimLight = 120;\n            brightLight = 60;\n            lockRotation = false;\n            lightAngle = 52.5;\n            break;\n          case \"hooded-dim\":\n            dimLight = 5;\n            brightLight = 0;\n            break;\n          case \"hooded-bright\":\n            dimLight = 60;\n            brightLight = 30;\n            break;\n          case \"light\":\n            dimLight = 40;\n            brightLight = 20;\n            break;\n          case \"torch\":\n            dimLight = 40;\n            brightLight = 20;\n            break;\n          case \"nochange\":\n          default:\n            dimLight = token.data.dimLight;\n            brightLight = token.data.brightLight;\n            lightAngle = token.data.lightAngle;\n            lockRotation = token.data.lockRotation;\n        }\n        // Update Token\n        console.log(token);\n        token.update({\n          vision: true,\n          dimSight: dimSight,\n          brightSight: brightSight,\n          dimLight: dimLight,\n          brightLight:  brightLight,\n          lightAngle: lightAngle,\n          lockRotation: lockRotation\n        });\n      }\n    }\n  }\n}).render(true);","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/vision.jpg","actorIds":[],"_id":"2PaqqaxjFAGmHtCG"}
{"name":"Gold_Changer","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro ","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.9ueMmrsGlKkx6kV8"}},"scope":"global","command":"//Money Give/Remover -> target necessary\n\n(()=>{\n\tlet targets = game.user.targets;\n\n\tlet targets_content =``;\n\n\tfor(let target of targets)\n\t{\n\t\ttargets_content += `<img src=${target.data.img} width=\"50\" height=\"50\">`\n\t}\n\n\tlet dialog_content = `\n\t<p></p>\n\t${targets_content}\n\t<div class = \"form-group\">\n\t\t<label for=\"pp\">Platnium<label>\n\t\t<input name=\"pp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"><br>\n\t\t<label for=\"gp\">Gold    <label>\n\t\t<input name=\"gp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"><br>\n\t\t<label for=\"ep\">Electrum<label>\n\t\t<input name=\"ep\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"><br>\n\t\t<label for=\"sp\">Silver  <label>\n\t\t<input name=\"sp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"><br>\n\t\t<label for=\"cp\">Copper  <label>\n\t\t<input name=\"cp\" type =\"number\" value=\"0\" min=\"-999\" max=\"999\"><br>\n\t</div>`;\n\n\tnew Dialog({\n\t\tcontent : dialog_content,\n\t\tbuttons : \n\t\t{\n\t\t\tOk : {icon : ``, label : `Change Money.`, callback : (html) => changeMoney(targets,html)}\n\t\t}\n\t}).render(true);\n})();\n\nasync function changeMoney(targets,html)\n{\n\tlet difference_money = {\n\t\tpp : parseInt(html.find('[name=pp]')[0].value),\n\t\tgp : parseInt(html.find('[name=gp]')[0].value),\n\t\tep : parseInt(html.find('[name=ep]')[0].value),\n\t\tsp : parseInt(html.find('[name=sp]')[0].value),\n\t\tcp : parseInt(html.find('[name=cp]')[0].value)\n\t}\n\n  //console.log(targets,update_money);\n  \n  //divide update_money based on # of targets\n  difference_money = divideValue(difference_money, targets.size);\n\n  console.log(difference_money);\n\n\tfor(let target of targets)\n\t{\n    let original_money = duplicate(target.actor.data.data.currency);\n    let update_money = changeValue(original_money,difference_money);    \n\n    console.log(target.actor.name)\n    console.log(original_money)\n    console.log(difference_money)\n    console.log(update_money);\n\n    await target.actor.update({\"data.currency\" : update_money});\n\t}\n}\n\nfunction changeValue(Original, Difference)\n{\n  let Update = {pp :0, gp:0, ep:0, sp :0, cp: 0};\n\n  for(let key in Original)\n  {\n    Update[key] = Original[key] + Difference[key];\n    if(Update[key] < 0)\n    {\n      switch(key)\n      {\n        case \"cp\" :\n          if (Update[\"sp\"] > 0)\n          {\n            Update[\"cp\"] += 10;\n            Update[\"sp\"] -= 1;\n          }\n          else if(Update[\"ep\"] > 0)\n          {\n            Update[\"cp\"] += 50;\n            Update[\"ep\"] -= 1;\n          }\n          else if(Update[\"gp\"] > 0)\n          {\n            Update[\"cp\"] += 100;\n            Update[\"gp\"] -= 1;\n          }\n          else if(Update[\"pp\"] > 0)\n          {\n            Update[\"cp\"] += 1000;\n            Update[\"pp\"] -= 1;\n          }else{\n            throw new Error(`Not enough money to do that.`);\n          }\n          Update = changeValue(Update, {pp :0, gp:0, ep:0, sp :0, cp: 0});\n          break;\n        case \"sp\" :\n          if (Update[\"ep\"] > 0)\n          {\n            Update[\"sp\"] += 5;\n            Update[\"ep\"] -= 1;\n          }\n          else if(Update[\"gp\"] > 0)\n          {\n            Update[\"sp\"] += 10;\n            Update[\"gp\"] -= 1;\n          }\n          else if(Update[\"pp\"] > 0)\n          {\n            Update[\"sp\"] += 100;\n            Update[\"pp\"] -= 1;\n          }\n          else if(Update[\"cp\"] > 9)\n          {\n            Update[\"sp\"] += 1;\n            Update[\"cp\"] -= 10;\n          }else{\n            throw new Error(`Not enough money to do that.`);\n          }\n          Update = changeValue(Update, {pp :0, gp:0, ep:0, sp :0, cp: 0});\n          break;\n        case \"ep\" :\n          if (Update[\"gp\"] > 0)\n          {\n            Update[\"ep\"] += 2;\n            Update[\"gp\"] -= 1;\n          }\n          else if(Update[\"pp\"] > 0)\n          {\n            Update[\"ep\"] += 20;\n            Update[\"pp\"] -= 1;\n          }\n          else if(Update[\"sp\"] > 4)\n          {\n            Update[\"ep\"] += 1;\n            Update[\"sp\"] -= 5;\n          }\n          else if(Update[\"cp\"] > 49)\n          {\n            Update[\"ep\"] += 1;\n            Update[\"cp\"] -= 50;\n          }else{\n            throw new Error(`Not enough money to do that.`);\n          }\n          Update = changeValue(Update, {pp :0, gp:0, ep:0, sp :0, cp: 0});\n          break;\n        case \"gp\" :\n          if (Update[\"pp\"] > 0)\n          {\n            Update[\"gp\"] += 10;\n            Update[\"pp\"] -= 1;\n          }\n          else if(Update[\"ep\"] > 1)\n          {\n            Update[\"gp\"] += 1;\n            Update[\"ep\"] -= 2;\n          }\n          else if(Update[\"sp\"] > 9)\n          {\n            Update[\"gp\"] += 1;\n            Update[\"sp\"] -= 10;\n          }\n          else if(Update[\"cp\"] > 99)\n          {\n            Update[\"gp\"] += 1;\n            Update[\"cp\"] -= 100;\n          }else{\n            throw new Error(`Not enough money to do that.`);\n          }\n          Update = changeValue(Update, {pp :0, gp:0, ep:0, sp :0, cp: 0});\n          break;\n        case \"pp\" :\n          if (Update[\"gp\"] > 9)\n          {\n            Update[\"pp\"] += 1;\n            Update[\"gp\"] -= 10;\n          }\n          else if(Update[\"ep\"] > 19)\n          {\n            Update[\"pp\"] += 1;\n            Update[\"ep\"] -= 20;\n          }\n          else if(Update[\"sp\"] > 99)\n          {\n            Update[\"pp\"] += 1;\n            Update[\"sp\"] -= 100;\n          }\n          else if(Update[\"cp\"] > 999)\n          {\n            Update[\"pp\"] += 1;\n            Update[\"cp\"] -= 1000;\n          }else{\n            throw new Error(`Not enough money to do that.`);\n          }\n          Update = changeValue(Update, {pp :0, gp:0, ep:0, sp :0, cp: 0});\n      }\n    }\n  }\n  return Update;\n}\n\nfunction divideValue(Object, Value)\n{\n  if(Value === 1) return Object;\n  let remainder = 0;\n  let Update = {pp :0, gp:0, ep:0, sp :0, cp: 0};\n\n  for(let key in Object)\n  {\n    Update[key] = Object[key] + remainder;\n    remainder = Object[key]%Value;\n    if(Update[key] > 0) Update[key] = Math.floor(Update[key]/Value);\n    if(Update[key] < 0) Update[key] = Math.ceil(Update[key]/Value);\n    if(remainder !== 0)\n    {\n      if(key === \"ep\")\n      {remainder *= 5;}\n      else if (key === \"gp\")\n      {remainder *= 2;}\n      else\n      {remainder *= 10;}\n    }\n  }\n  console.log(`There was ${remainder/10} cp left over.`);\n  return Update;\n}\n\nfunction x(Original, edit_key)\n{\n  let Update = duplicate(Original);\n  for(let key in Update)\n  {\n    if(key === edit_key)\n    {\n\n    }\n  }\n}","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/gold.png","actorIds":[],"_id":"E4errsrb19mXoeL9"}
{"name":"Timer","type":"script","author":"V3S7gLWyximUusS6","img":"modules/GMmacros/img/Clocl.png","scope":"global","command":"let seconds_selected = 0;\nlet seconds_left = 0;\n\nlet times = {\n  buttons : [\n    [\"1 Min\", ()=> { seconds_selected = seconds_left = 60; update_dialog();}],\n    [\"2 Min\", ()=> { seconds_selected = seconds_left = 120; update_dialog();}],\n    [\"10 Min\", ()=> { seconds_selected = seconds_left = 600; update_dialog(); }],\n    [\"15 Min\", ()=> { seconds_selected = seconds_left = 900; update_dialog(); }],\n    [\"20 Min\", ()=> { seconds_selected = seconds_left = 1200; update_dialog(); }],\n    [\"30 Min\", ()=> { seconds_selected = seconds_left = 1800; update_dialog(); }]\n  ],\n  content : `<div sytle=\"width:100%; text-align:center;\"><h2> Choose a timer limit : </h2></div>`,\n  title : `Timer Selector`\n};\n\nasync function button_dialog(data)\n{\n  let value = await new Promise((resolve) => {\n    let buttons = {}, dialog;\n\n    data.buttons.forEach(([str, callback])=>{\n      buttons[str] = {\n        label : str,\n        callback\n      }\n    });\n  \n    dialog = new Dialog({title : data.title , content : data.content, buttons, close : () => resolve(true) }).render(true);\n  });\n  return value;\n}\n\nasync function update_dialog()\n{\n  let interval, content, buttons, dialog, interval_time;\n\n  interval_time = 1;\n  content = getContent();\n  buttons = getButtons();\n\n  dialog = new Dialog({ title : `Timer`, content, buttons, close : () =>  { clearInterval(interval); }}, {width : 200 }).render(true);\n\n  console.log(dialog);\n\n  interval = setInterval(()=> {\n    update();\n  }, interval_time * 1000);\n\n  function getContent()\n  {\n\n    if(seconds_left !== 0 )\n    {\n      let minutes = Math.floor(seconds_left/60);\n      let seconds = seconds_left%60;\n  \n      if (minutes < 10) minutes = `0${minutes}`;\n      if (seconds < 10) seconds = `0${seconds}`;\n\n      return `<div sytle=\"width:100%; text-align:center;\"><h1>${minutes}:${seconds}</h1></div>`;\n    }else{\n      if(dialog.data.content.includes(`Complete`))\n      {\n        return ``;\n      }else{\n        return `<div sytle=\"width:100%; text-align:center; color:red;\"><h1>Complete</h1></div>`;\n      }\n    }\n  }\n  function getButtons()\n  {\n    return {\n      Restart : { label : `Restart`, callback : () => { seconds_left = seconds_selected; update_dialog(); }},\n      Cancel : { label : `Cancel`, callback : () => { clearInterval(interval); }}\n    };\n  }\n  function update()\n  {\n    if(seconds_left !== 0) seconds_left--;\n\n    dialog.data.content = getContent();\n    dialog.render(true);\n  }\n}\n\nbutton_dialog(times);","folder":null,"sort":0,"permission":{"default":0,"V3S7gLWyximUusS6":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"core":{"sourceId":"Macro.zDlhPUiiLzlHF7fb"}},"_id":"H546dFpPwCBTKxqJ"}
{"name":"Blinding_GM","type":"script","author":"rbM5nB1AbUwbj4yJ","img":"modules/plutonium/media/icon/spell/phb-blinding-smite.webp","scope":"global","command":"const spellDC = args[2];\nconst lastArg = args[args.length - 1];\nlet tactor;\nif (lastArg.tokenId) tactor = canvas.tokens.get(lastArg.tokenId).actor;\nelse tactor = game.actors.get(lastArg.actorId);\n\nlet saveType = \"con\";\nlet flavor = `${CONFIG.DND5E.abilities[saveType]} DC${spellDC}`;\nlet save = (await tactor.rollAbilitySave(saveType, { flavor, fastForward: true })).total;\nif (save >= spellDC) {\ngame.cub.hasCondition(\"Blinded\", tactor) ? await game.cub.removeCondition(\"Blinded\", tactor) : game.cub.removeCondition(\"Blinded\", tactor)\ntactor.deleteEmbeddedEntity(\"ActiveEffect\", lastArg.effectId)\n}","folder":null,"sort":0,"permission":{"default":0,"rbM5nB1AbUwbj4yJ":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"exportSource":{"world":"criador","system":"dnd5e","coreVersion":"0.8.8","systemVersion":"1.3.6"},"core":{"sourceId":"Macro.3taNq3hKnIm24Ex9"}},"_id":"IRZcRNynf36Qe39A"}
{"name":"Set Token bars and nameplate","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Set Token bars and nameplate ","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.iOX5h0jIxJI0VTdW"}},"scope":"global","command":"/* This will set every token in scene to always display their\n * token bars and nameplate, and sets the first bar to represent \n * HP and removes the second token bar.\n*/\n\nconst tokens =canvas.tokens.placeables.map(token => {\n   return {\n       _id: token.id,\n       \"bar1.attribute\": \"attributes.hp\",\n       \"bar2.attribute\": \"\",\n       \"displayName\": CONST.TOKEN_DISPLAY_MODES.ALWAYS,\n       \"displayBars\": CONST.TOKEN_DISPLAY_MODES.ALWAYS\n   };\n});\n\ncanvas.scene.updateEmbeddedEntity('Token', tokens)","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/Token_bar-Names.png","actorIds":[],"_id":"Mhu8fbpc7bL8hYJN"}
{"name":"Activate_effect_criando","type":"script","author":"rbM5nB1AbUwbj4yJ","img":"icons/svg/dice-target.svg","scope":"global","command":"const effect = {\nlabel: \"Dodge\", icon: \"modules/GMmacros/img/defensive-stance.jpg\", \nchanges: [{value: 1, mode: CONST.ACTIVE_EFFECT_MODES.OVERRIDE, priority: 20, key:\"flags.midi-qol.grants.disadvantage.attack.all\"}],\nduration: {rounds: 1}\n};\n\nif(token){\n  let effectPresent = !!token.actor.effects.find(e => e.data.label === effect.label);\n  if(effectPresent) removeEffect({ actor : token.actor, effectLabel : effect.label });\n  else addEffect({ actor : token.actor, effectData : effect });\n}\n\nasync function removeEffect({ actor, effectLabel }){\n  if(!actor || !effectLabel) return;\n  let effect = actor.effects.find(e => e.data.label === effectLabel);\n  if(!effect) return;\n\n  await actor.deleteEmbeddedEntity(\"ActiveEffect\", [effect.id]);\n}\nasync function addEffect({ actor, effectData }){\n  if(!actor || !effectData) return;\n  await actor.createEmbeddedEntity(\"ActiveEffect\", effectData );\n}","folder":null,"sort":0,"permission":{"default":0,"rbM5nB1AbUwbj4yJ":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"exportSource":{"world":"criador","system":"dnd5e","coreVersion":"0.8.8","systemVersion":"1.3.6"},"macro-marker":{"activeData":{"tooltip":"Activate Effect"}},"core":{"sourceId":"Macro.gci5bb1cckFTR42p"}},"_id":"MpmExeEC7crDxfnn"}
{"name":"Passar_turno","type":"script","author":"rbM5nB1AbUwbj4yJ","img":"modules/GMmacros/img/skip_turn.jpg","scope":"global","command":"game.combat.nextTurn()","folder":null,"sort":0,"permission":{"default":0,"rbM5nB1AbUwbj4yJ":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"exportSource":{"world":"criador","system":"dnd5e","coreVersion":"0.8.8","systemVersion":"1.3.6"},"core":{"sourceId":"Macro.Us9ANKoXgfEYWFxz"}},"_id":"NtXVFZfPvFdpD9Zl"}
{"name":"ADD-Cub-Condition","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.RpuEJrkUjZIDqVU2"}},"scope":"global","command":"let options = '';\ngame.cub.conditions.forEach((item) => {\n  options += `<option value=\"${item.name}\">\\n`;\n});\nlet content = `\n<form>\n  <div class=\"form-group\">\n    <label for=\"condition\">Condition:</label>\n    <input list=\"conditions\" id=\"condition\" name=\"condition\"/ autofocus>\n    <datalist id=\"conditions\">\n      ${options}\n    </datalist>\n  </div>\n</form>\n`\n\nnew Dialog({\n  title: `Select Condition`,\n  content: content,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Apply`,\n      callback: (html) => {\n        let condition = html.find('#condition').val();\n        if (!game.cub.conditions.some(el => el.name === condition)) {\n          return ui.notifications.info(\"Select a valid condition.\");\n        }\n\n        //apply the condition to selected tokens (0.6.6)\n        //game.cub.applyCondition(condition);\n\n    //apply the condition to the selected tokens (0.7.5)\n    game.cub.addCondition(condition);\n\n      }\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: `Cancel`\n    },\n  },\n  default: \"yes\"\n}).render(true);\n\n(async () => {\n  await new Promise(resolve => setTimeout(resolve, 20));\n  let input = $('#condition').focus();\n})();","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/0%20add_effects%20-%20Copia.png","actorIds":[],"_id":"Ru5ktRnPyz60nsxm"}
{"name":"Display Attribute Lists for Selected Actor","permission":{"default":0,"NeG597KOgANJAOdY":3},"type":"script","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.vIYlN91XcHeOY5KW"}},"scope":"global","command":"ShowActorAttributeData(actor);","author":"NeG597KOgANJAOdY","img":"icons/svg/book.svg","actorIds":[],"_id":"XCpYWe1J18bOKtAf"}
{"name":"DoTrapAttack","type":"script","author":"05k4ub2VgC3VLxAg","img":"modules/GMmacros/img/trap.png","scope":"global","command":"// Requires midi-qol to work at all\n// Rolls an attack from actor args[0] using item args[1] and display a token args[2]\nlet tactor = game.actors.entities.find(a => a.name === args[0])\nif (!tactor) return `/Whisper GM \"DoTrap: Target token ${args[0]} not found\"`\nlet item = tactor.items.find(i=>  i.name === args[1])\nif (!item) return `/Whisper GM \"DoTrap: Item ${args[1]} not found\"`\nlet oldTargets = game.user.targets;\ngame.user.targets = new Set().add(token);\nlet trapToken = canvas.tokens.placeables.find(t=>t.name === args[2]);\nif(trapToken.data.hidden) {\nnew MidiQOL.TrapWorkflow(tactor, item, [token], trapToken.center)\n//uncomment the next line if you use conditional visibility to hide traps\n//game.cub.removeAllConditions(trapToken);\nif (trapToken) await trapToken.update({\"hidden\" : false});\n}","folder":null,"sort":0,"permission":{"default":0,"05k4ub2VgC3VLxAg":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":false},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"core":{"sourceId":"Macro.I7zTvROyLfRboIHq"}},"_id":"XLRUHkIJDhtoc12i"}
{"name":"Stealth Check","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Stealth Check","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.RTiO1Z1tasafiWAo"}},"scope":"global","command":"// Grabs selected tokens and rolls a stealth check against all other tokens passive perception on the map. Then returns the result.\n\n// getting all actors of selected tokens\nlet actors = canvas.tokens.controlled.map(({ actor }) => actor);\n\n// if there are no selected tokens, roll for the player's character.\nif (actors.length < 1) {\n  actors = game.users.entities.map(entity => {\n    if (entity.active && entity.character !== null) {\n      return entity.character;\n    }\n  });\n}\nconst validActors = actors.filter(actor => actor != null);\n\nlet messageContent = 'pp = passive perception<br>';\n\n// roll for every actor\nfor (const selectedActor of validActors) {\n  const stealthMod = selectedActor.data.data.skills.ste.total; // stealth roll\n  const stealth = new Roll(`1d20+${stealthMod}`).roll().total; // rolling the formula\n  messageContent += `<hr><h3>${selectedActor.name} stealth roll was a <b>${stealth}</b>.</h3>`; // creating the output string\n\n  // grab a list of unique tokens then check their passive perception against the rolled stealth.\n  const uniqueActor = {};\n  const caughtBy = canvas.tokens.placeables\n    .filter(token => !!token.actor)\n    .filter(({ actor }) => { // filter out duplicate token names. ie: we assume all goblins have the same passive perception\n      if (uniqueActor[actor.name]) {\n        return false;\n      }\n      uniqueActor[actor.name] = true;\n      return true;\n    })\n    .filter(({ actor }) => {\n      return selectedActor.id !== actor.id; // Don't check to see if the token sees himself.\n    })\n    .filter(({ actor }) => actor.data.data.skills.prc.passive >= stealth); // check map tokens passives with roller stealth\n\n  if (!caughtBy.length) {\n    messageContent += 'Stealth successful!<br>';\n  } else {\n    messageContent += 'Stealth questionable:<br>';\n    caughtBy.map(({ actor }) => {\n      messageContent += `<b>${actor.name}</b> pp(${actor.data.data.skills.prc.passive}).<br>`;\n    });\n  }\n}\n\n// create the message\nconst chatData = {\n  user: game.user._id,\n  speaker: game.user,\n  content: messageContent,\n  whisper: game.users.entities.filter((u) => u.isGM).map((u) => u._id),\n};\nChatMessage.create(chatData, {});","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/StealthCheck.jpg","actorIds":[],"_id":"bjOlsOzn1A1qew1b"}
{"name":"Attacher","type":"script","author":"QwT9izJ4aW8QVTjo","img":"icons/svg/target.svg","scope":"global","command":"async function TemplateAttach() {\n    const templateID = canvas.templates.placeables[canvas.templates.placeables.length - 1].data._id;\n    let template = await canvas.templates.get(templateID);\n    let target_token = canvas.tokens.placeables.find(i => i.center.x === template.center.x && i.center.y === template.center.y);\n    tokenAttacher.attachElementToToken(template, target_token)\n}\nTemplateAttach();","folder":null,"sort":0,"permission":{"default":0,"QwT9izJ4aW8QVTjo":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"advanced-macros":{"runAsGM":true},"core":{"sourceId":"Macro.c7EmRH2EiyZ2gtvI"}},"_id":"bkybrbMBy35BUlp2"}
{"name":"Show_DAE_Effect","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.zTEAaKrJTPbu5feQ"}},"scope":"global","command":"new DAE.ActiveEffects(actor, {}).render(true)","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/Show_effects.png","actorIds":[],"_id":"h02h04Tf54HVf3WH"}
{"name":"FX- Delete filters on Selected","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"00 - A - Delete filters on Selected","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.k3nJVdOcsbMDVnrb"}},"scope":"global","command":"// Delete all filters on the selected tokens/tiles\nTokenMagic.deleteFiltersOnSelected();","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/filter_delete.png","actorIds":[],"_id":"ncziV2PK1rIupbC6"}
{"name":"Toggle DEA via Macro","permission":{"default":0,"X2FU4EYTKyUpwF0o":3},"type":"chat","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.5brmSxdf10g513Vt"}},"scope":"global","command":"const nome = \"MeuEfeito\"; // Troque MeuEfeito pelo nome exato do efeito que você quer ligar ou desligar.\n\nconst macroVersion = 'v0.2';\n\n/* Ativar/Desativar Efeito\nSource: https://raw.githubusercontent.com/brunocalado/mestre-digital/master/Foundry%20VTT/Macros/DnD%205e/ToogleAE.js\nIcon: \n*/\n//\n\nif (!actor) {\n  ui.notifications.warn(`Selecione um token!`); // get selected token \n} else {\n  main();\n}\n\nasync function main() {  \n  let effect = canvas.tokens.controlled[0].actor.effects.find(i => i.data.label === nome);\n  if (!effect) {\n    ui.notifications.warn(`Efeito não localizado!`); // get selected token \n  } else {\n    await effect.update({disabled: !effect.data.disabled});            \n    let mensagem = `O efeito <b>${nome}</b> foi <b>${effect.data.disabled?'ligado':'desligado'}</b>`;\n    let chatData = {\n      user: game.user._id,\n      speaker: ChatMessage.getSpeaker(),\n      content: mensagem\n    };  \n    ChatMessage.create(chatData, {});    \n    \n  }\n}","author":"X2FU4EYTKyUpwF0o","img":"modules/GMmacros/img/ToggleDae.png","actorIds":[],"_id":"oSXKzjHL7Tc7pMvK"}
{"name":"Add-TempHP","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"New Macro","colour":"#ff0000","trigger":""}},"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.rl0SGMTuz0vHiWpC"}},"scope":"global","command":"//Add or subtract Temp HP. Will do math or rolls.\n//Preface with \"=\" to set to exactly that number\n/* Alt Use: */\n//Can be used wtihin entity link buttons. Anything but the first number is ignored.\n//\"->\" can be used to subtract the number of the next inline roll encountered\n//\"+>\" can be used to add the number of the next inline roll encountered\n//\"=>\" can be used to set to the number of the next inline roll encountered\n//Examples: (All are equivalent)\n//\t@Macro[Add Temp HP]{Add Temp HP ->}[[5+3]]\n//\t@Macro[Add Temp HP]{+8 THP}\n//\t@Macro[Add Temp HP]{Set to =>}[[@attributes.hp.temp + 3 + 5]]\n\nvar controlled = canvas.tokens.controlled.map(o => o.actor),\n\tinputText = false,\n\tchatMessage = game.messages.get(event.srcElement.closest('.message')?.getAttribute('data-message-id'));\nif (window.macroChain?.length || event.srcElement.nodeName == 'A')\n\tinputText = window.macroChain?.pop() || event.srcElement.textContent.trim();\n\nif (inputText) {\n\tif (inputText.indexOf('->') > -1)\n\t\tinputText = '-1 * (' + event.srcElement.nextElementSibling?.textContent.trim() + ')';\n\telse if (inputText.indexOf('+>') > -1)\n\t\tinputText = event.srcElement.nextElementSibling?.textContent.trim();\n\telse if (inputText.indexOf('=>') > -1)\n\t\tinputText = '=' + event.srcElement.nextElementSibling?.textContent.trim();\n\telse\n\t\tinputText = inputText.match(/([=-]?\\d)+/)?.[1];\n}\nif (!inputText) {\n\tlet d = new Dialog({\n\t\ttitle: 'How much Temp HP?',\n\t\tcontent: '<input name=\"temphp\" type=\"text\" class=\"temphp select-on-click\" placeholder=\"+Temp.\" title=\"Temporary Hit Points\" autofocus>',\n\t\tbuttons: {\n\t\t  ok: {\n\t\t\ticon: '',\n\t\t\tlabel: \"OK\",\n\t\t\tcallback: applyTHP\n\t\t  }\n\t\t},\n\t\tdefault: 'ok'\n\t  }, {width: 100});\n\tHooks.once('renderDialog', (a,inp) => inp[0].querySelector('input').focus());\n\td.render(true);\n}\nelse\n\tapplyTHP(null, inputText);\n\nfunction applyTHP(htm, fromButton=false) {\n\tcontrolled.forEach(selected => {\n\t\tlet change = 0, equal;\n\t\tif (fromButton || fromButton === '0')\n\t\t\tchange = fromButton;\n\t\telse\n\t\t\tchange = htm[0].querySelector('input').value;\n\t\tif (change.charAt(0) == '=') {\n\t\t\tequal = true;\n\t\t\tchange = change.slice(1);\n\t\t}\n\t\tlet parsed = parseInt((new Roll(change).roll()).total),\n\t\t\tdifference = Math.max(selected.data.data.attributes.hp.temp + parsed, 0);\n\t\tif (equal)\n\t\t\tselected.update({'data.attributes.hp.temp': parsed});\n\t\telse\n\t\t\tselected.update({'data.attributes.hp.temp': difference});\n\t});\n}","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/add_temp_hp.png","actorIds":[],"_id":"r4wbqk6YgFKhPrsS"}
{"name":"REMOVE CUB Effects","permission":{"default":0,"z3axZ8yAkgVHJACm":3},"type":"script","flags":{"combat-utility-belt":{"macroTrigger":""},"furnace":{"runAsGM":false},"macro-marker":{"activeData":{"icon":"icons/svg/dice-target.svg","tooltip":"Show Active/Passive Effects","colour":"#ff0000","trigger":""}},"core":{"sourceId":"Macro.SnRtyqW34JPBMHwG"}},"scope":"global","command":"game.cub.removeAllConditions()","author":"z3axZ8yAkgVHJACm","img":"modules/GMmacros/img/Effect_remove_CUB.png","actorIds":[],"_id":"tcfLoUc51K9ewxC3"}
